# jpnkn Fast インターフェイス (MQTT) 仕様書

本アプリが利用している jpnkn のリアルタイム配信インターフェイスに関する技術仕様です。

## 出典
- [jpnkn 開発者向け機能](https://doc.bbs.jpnkn.com/dev.html#mqtt%E9%80%9A%E4%BF%A1)

## MQTT 接続情報
ユーザー権限は **Read Only** です。以下のいずれかのサーバーを利用します。

### サーバー1
- **アドレス**: `bbs.jpnkn.com`
- **ポート**: `1883`
- **ユーザー名**: `genkai`
- **パスワード**: `7144`
- **購読トピック**: `bbs/{board_id}`

### サーバー2 (代替)
- **アドレス**: `a.mq.jpnkn.com`
- **ポート**: `1884`
- **ユーザー名**: `genkai`
- **パスワード**: `7144`
- **購読トピック**: `bbs/{board_id}`

## メッセージ形式 (JSON)
新着レス発生時に配信されるメッセージの構造です。

### 実際のペイロード形式（現行）

```json
{
  "body": "名無しさん<>sage<>2026/02/03(火) 00:11:43.89<>確定申告をはじめましょう<>",
  "no": "498",
  "bbsid": "mamiko",
  "threadkey": "1769773535"
}
```

**フィールド説明:**
- `body` (string): `<>` で区切られたデータ
  - `parts[0]`: 名前
  - `parts[1]`: メール欄 (sage等)
  - `parts[2]`: 日時
  - `parts[3]`: **レス本文**
- `no` (string): レス番号（文字列形式）
- `bbsid` (string): 板ID
- `threadkey` (string): スレッドキー

## 実装上の注意点
1. **購読トピックの接頭辞**: 
   公式仕様に基づき、トピック名は `bbs/` で始まる必要があります。
2. **bodyフィールドのパース**: 
   `body` を `<>` で分割し、`parts[3]` がレス本文となります。

